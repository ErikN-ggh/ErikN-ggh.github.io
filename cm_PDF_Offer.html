<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="simplified_Logo.png">
    <title>Angebot erstellen</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body
        {
            font-family: Arial, sans-serif;
            padding: 2rem;
            max-width: 800px;
            margin: auto;
        }
        label
        {
            display: block;
            margin-top: 1rem;
            font-weight: bold;
        }
        input, textarea, select
        {
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 95%;
            margin-top: 0.25rem;
        }
        button
        {
            margin-top: 10px;
            padding: 10px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #btn
        {
            margin-top: 10px;
            padding: 10px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .position
        {
            margin-top: 15px;
            border: 1px solid #cfcfcf;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            background: #f1f1f1;
        }
        #hinweis
        {
            padding: 1pt;
            border-radius: 5px;
            border: 1px solid #ff6f6f;
        }
        #Back
        {
            margin-top: 15px;
            margin-bottom: 15px;
        }
        #hinweis p
        {
            text-align: center;
            color: rgb(175, 175, 175);
            padding: 1px;
            font-size: 10pt;
        }
        .id_back
        {
            padding-left: 5px;
        }
    </style>
</head>
<body>
    <h1>Angebot erstellen</h1>
    <label>Angebotnummer</label>
    <input type="text" id="off_num" required>

    <label>Name & Anschrift des Unternehmers</label>
    <textarea id="seller" required></textarea>

    <label>Name & Anschrift des Empfängers</label>
    <textarea id="buyer" required></textarea>

    <label>Ausstellungsdatum</label>
    <input type="date" id="date" required>

    <label>Text</label>
    <textarea type="text" id="Info" style="height: 6em;">
Sehr geehrte/r Frau/Herr [Name],
---
Sehr geehrte Damen und Herren,
---
Vielen Dank für Ihre Anfrage vom [Datum] bezüglich [Produkt/Dienstleistung].
---
Bezugnehmend auf unser Telefonat/Gespräch vom [Datum] unterbreiten wir Ihnen folgendes Angebot:
---
Wir freuen uns über Ihr Interesse an [Produkt/Dienstleistung] und senden Ihnen hiermit unser Angebot.
---
Sehr geehrte/r [Name des Kunden],

vielen Dank für Ihre Anfrage. Gerne unterbreiten wir Ihnen folgendes Angebot:

Bezeichnung: [_____________]
Beschreibung: [Kurze Beschreibung der angebotenen Leistung, z. B. Entwicklung einer Webanwendung, Einrichtung eines Tools, Beratung etc.]
---
Der Preis für diese Leistung beträgt [Betrag].
---
Gesamtpreis (netto): [] €
zzgl. [19 %] MwSt.: [] €
Gesamtpreis (brutto): [_____________] €

Mit Freundlichen Grüßen,


    </textarea>

    <label>Logo hochladen</label>
    <input type="file" id="imageInput" accept="image/*">

    <button type="submit" onclick="generatePDF()">Angebot erstellen</button>
    <script>

        async function generatePDF()
        {
            let OfferNumber = document.getElementById("off_num").value;
            let SellerAddress = document.getElementById("seller").value;
            let BuyerAddress = document.getElementById("buyer").value;
            let datestr = document.getElementById("date").value;

            let Info = document.getElementById("Info").value;

            let d1 = datestr.replace('-', '.');
            let Date = d1.replace('-', '.');

            let width = 80;
            let result = "";
            let start = 0;

            let paragraphs = Info.split("\n");
            let wrappedParagraphs = [];

            for (let para of paragraphs) {
                let result = "";
                let start = 0;

                while (start < para.length) {
                    let end = start + width;

                    // Wenn Rest kürzer ist, einfach anhängen
                    if (end >= para.length) {
                        result += para.slice(start);
                        break;
                    }

                    // Suche letztes Leerzeichen vor der 80. Position
                    let spaceIndex = para.lastIndexOf(" ", end);

                    // Falls kein Leerzeichen vorhanden → harter Cut
                    if (spaceIndex <= start) {
                        spaceIndex = end;
                    }

                    result += para.slice(start, spaceIndex) + "\n";
                    start = spaceIndex + 1;
                }

                wrappedParagraphs.push(result);
            }

            // Füge alle Absätze wieder mit \n zusammen
            Info = wrappedParagraphs.join("\n");

            //check minimal requirements
            if(OfferNumber == '')
            {
                alert("Bitte geben sie eine Angebotssnummer an");
                return;
            }

            if(SellerAddress == '')
            {
                alert("Bitte geben sie die Adresse des Unternehmens an");
                return;
            }

            if(BuyerAddress == '')
            {
                alert("Bitte geben sie die Adresse des Empfängers an");
                return;
            }

            if(Date == '')
            {
                alert("Bitte geben sie ein Erstelldatum an");
                return;
            }
            

            //create PDF

            const {jsPDF} = window.jspdf;
            const doc = new jsPDF('p', 'cm', 'a4');

            const fileInput = document.getElementById("imageInput");
            const file = fileInput.files[0];

            const reader = new FileReader();
            reader.onload = function (e)
            {
                if (file)
                {
                    const imgData = e.target.result;
                    doc.addImage(imgData, 'JPEG', 14, 2, 4, 0);
                }

                doc.setFont('Helvetica', 'normal');
                doc.setFontSize(20);
                doc.text(9, 4, "Angebot");
                doc.setFontSize(12);
                doc.text(2, 6, BuyerAddress);
                doc.text(14, 6, SellerAddress);
                doc.text(14, 8, "Angebot Nummer: " + OfferNumber);
                doc.text(14, 8.5, "Datum: " + Date);
                
                doc.text(2, 12, Info);

                doc.save("Angebot_" + OfferNumber.toString());
            };
            if(file)
            {
                reader.readAsDataURL(file);
            }
            else
            {
                // Falls kein Bild hochgeladen wurde
                reader.onload({ target: { result: null } });
            }
        }
    </script>

    <div id="Back">
        <a href="PDF_ind.html">Zurück</a>
    </div>
    <div id="hinweis">
        <p id="bold">Hinweis</p>
        <p>Die eingegebenen Daten werden nicht geprüft. Für die Richtigkeit, Vollständigkeit und rechtliche Konformität der von Ihnen erstellten Angebote übernehmen wir keine Haftung. Die Nutzung dieser Anwendung erfolgt auf eigene Verantwortung.
        Rechtlicher Hinweis: Diese Anwendung stellt keine steuerliche oder rechtliche Beratung dar. Die Verantwortung für die inhaltliche Richtigkeit und gesetzliche Korrektheit der erstellten Angebote liegt vollständig beim Nutzer. Eine Haftung für etwaige Schäden, oder Nachteile, die durch fehlerhafte oder unvollständige Angaben entstehen, ist ausgeschlossen.
        Für Angebote gillt eine Aufbewahrungfrist von 6 Jahren, sowie für alle sonstigen Unterlagen. Für die Aufbewahrung der Angebote ist der Nutzer selbst verantwortlich.
        </p>
      </div>
</body>
</html>
